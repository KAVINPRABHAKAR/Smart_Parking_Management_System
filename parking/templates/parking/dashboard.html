{% extends 'parking/base.html' %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-4 border-bottom">
        <h1 class="h2 fw-bold text-dark">üìä Parking Management Dashboard</h1>
        <div class="btn-toolbar mb-2 mb-md-0">
            <a href="{% url 'revenue_reports' %}" class="btn btn-sm btn-primary shadow-sm px-4 py-2 fw-bold">
                üìà View Full Analytics
            </a>
        </div>
    </div>

    <div class="row g-3 mb-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white shadow-sm border-0 h-100">
                <div class="card-body">
                    <p class="card-title text-white-50 mb-1 fw-bold text-uppercase small">Total Daily Revenue</p>
                    <h2 class="fw-bold mb-0">‚Çπ{{ analytics.total_revenue|default:"0.00"|floatformat:2 }}</h2>
                    <small class="text-white-50">Collected Today</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white shadow-sm border-0 h-100">
                <div class="card-body">
                    <p class="card-title text-white-50 mb-1 fw-bold text-uppercase small">Vehicles Processed</p>
                    <h2 class="fw-bold mb-0">{{ analytics.total_vehicles|default:"0" }}</h2>
                    <small class="text-white-50">Active & Exited</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-dark text-white shadow-sm border-0 h-100">
                <div class="card-body">
                    <p class="card-title text-white-50 mb-1 fw-bold text-uppercase small">Available Slots</p>
                    <h2 class="fw-bold mb-0">{{ available_slots }} / {{ total_slots }}</h2>
                    <div class="progress mt-2" style="height: 5px; background: rgba(255,255,255,0.2);">
                        <div class="progress-bar bg-success" role="progressbar" style="width: {% widthratio available_slots total_slots 100 %}%"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-dark shadow-sm border-0 h-100">
                <div class="card-body">
                    <p class="card-title text-dark-50 mb-1 fw-bold text-uppercase small">Avg. Ticket Size</p>
                    <h2 class="fw-bold mb-0">‚Çπ{{ analytics.avg_revenue|default:"0.00"|floatformat:2 }}</h2>
                    <small class="text-dark-50">Per Vehicle</small>
                </div>
            </div>
        </div>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="mb-0 fw-bold">Live Slot Monitoring</h4>
        <div class="badge bg-white text-dark border p-2 shadow-sm">
            <span class="spinner-grow spinner-grow-sm text-success me-2" role="status"></span>
            <span class="small fw-bold">LIVE STATUS AUTO-REFRESHING</span>
        </div>
    </div>

    <ul class="nav nav-pills mb-4 shadow-sm p-1 bg-white rounded border" id="pills-tab" role="tablist">
        <li class="nav-item flex-fill" role="presentation">
            <button class="nav-link active w-100 fw-bold" id="pills-vip-tab" data-bs-toggle="pill" data-bs-target="#pane-vip" type="button" role="tab">
                üåü VIP Zone
            </button>
        </li>
        <li class="nav-item flex-fill" role="presentation">
            <button class="nav-link w-100 fw-bold" id="pills-normal-tab" data-bs-toggle="pill" data-bs-target="#pane-normal" type="button" role="tab">
                üöó Standard Zone
            </button>
        </li>
    </ul>

    <div class="tab-content" id="pills-tabContent">
        <div class="tab-pane fade show active" id="pane-vip" role="tabpanel">
            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-4">
                {% for slot in slots %}
                    {% if slot.is_vip %}
                    <div class="col">
                        <div class="card text-center shadow-sm h-100 border-2 {% if slot.is_available %}border-success{% else %}border-danger{% endif %}">
                            <div class="card-header bg-white border-0 pt-3 d-flex justify-content-between">
                                <span class="fw-bold">#{{ slot.slot_number }}</span>
                                <span class="badge bg-warning text-dark">VIP</span>
                            </div>
                            <div class="card-body">
                                <h3 class="mb-2">{% if slot.vehicle_type == 'Car' %}üöó{% elif slot.vehicle_type == 'Bike' %}üèçÔ∏è{% else %}üöõ{% endif %}</h3>
                                
                                <div class="badge rounded-pill {% if slot.is_available %}bg-soft-success text-success{% else %}bg-soft-danger text-danger{% endif %} px-3 py-2 mb-2">
                                    {% if slot.is_available %}VACANT{% else %}OCCUPIED{% endif %}
                                </div>

                                {% if not slot.is_available %}
                                    {% for tx in slot.parkingtransaction_set.all %}
                                        {% if tx.is_active %}
                                            <p class="fw-bold text-dark mb-0 small mt-1">üë§ {{ tx.customer_name }}</p>
                                            <p class="text-muted extra-small">{{ tx.vehicle_number }}</p>
                                        {% endif %}
                                    {% endfor %}
                                {% else %}
                                    <p class="small text-muted mb-0 mt-1">{{ slot.vehicle_type }} Only</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>

        <div class="tab-pane fade" id="pane-normal" role="tabpanel">
            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-4">
                {% for slot in slots %}
                    {% if not slot.is_vip %}
                    <div class="col">
                        <div class="card text-center shadow-sm h-100 border-2 {% if slot.is_available %}border-success{% else %}border-danger{% endif %}">
                            <div class="card-header bg-white border-0 pt-3">
                                <span class="fw-bold">Slot {{ slot.slot_number }}</span>
                            </div>
                            <div class="card-body">
                                <h3 class="mb-2">{% if slot.vehicle_type == 'Car' %}üöó{% elif slot.vehicle_type == 'Bike' %}üèçÔ∏è{% else %}üöõ{% endif %}</h3>
                                
                                <div class="badge rounded-pill {% if slot.is_available %}bg-soft-success text-success{% else %}bg-soft-danger text-danger{% endif %} px-3 py-2 mb-2">
                                    {% if slot.is_available %}VACANT{% else %}OCCUPIED{% endif %}
                                </div>

                                {% if not slot.is_available %}
                                    {% for tx in slot.parkingtransaction_set.all %}
                                        {% if tx.is_active %}
                                            <p class="fw-bold text-dark mb-0 small mt-1">üë§ {{ tx.customer_name }}</p>
                                            <p class="text-muted extra-small">{{ tx.vehicle_number }}</p>
                                        {% endif %}
                                    {% endfor %}
                                {% else %}
                                    <p class="small text-muted mb-0 mt-1">{{ slot.vehicle_type }}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script>
    setTimeout(function(){ window.location.reload(1); }, 60000);
</script>

<style>
    .bg-soft-success { background-color: rgba(25, 135, 84, 0.1); border: 1px solid rgba(25, 135, 84, 0.2); }
    .bg-soft-danger { background-color: rgba(220, 53, 69, 0.1); border: 1px solid rgba(220, 53, 69, 0.2); }
    .extra-small { font-size: 0.75rem; }
    .nav-pills .nav-link { color: #6c757d; }
    .nav-pills .nav-link.active { background-color: #0d6efd !important; box-shadow: 0 4px 10px rgba(13,110,253,0.3); }
    .card { transition: all 0.2s ease-in-out; border-radius: 12px; }
    .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.08) !important; }
</style>
{% endblock %}